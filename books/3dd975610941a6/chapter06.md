---
title: "ç¬¬6ç« : å®Ÿè·µçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œ"
---

# ã¯ã˜ã‚ã«

å‰ç« ã§ã¯ã€PowerShellã‚’ä½¿ç”¨ã—ãŸã‚¯ãƒ©ã‚¦ãƒ‰ãƒªã‚½ãƒ¼ã‚¹ã®åŠ¹ç‡çš„ãªç®¡ç†ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚ã“ã®ç« ã§ã¯ã€ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œã«ã¤ã„ã¦ã€å®Ÿè·µçš„ãªè¨­å®šæ–¹æ³•ã‹ã‚‰ç›£æŸ»å¯¾å¿œã¾ã§è©³ã—ãå­¦ã‚“ã§ã„ãã¾ã™ã€‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¯ã€ç¾ä»£ã®ä¼æ¥­ITé‹ç”¨ã«ãŠã„ã¦æœ€ã‚‚é‡è¦ãªè¦ç´ ã§ã™ã€‚æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‹ã‚‰çµŒé¨“è±Šå¯Œãªç®¡ç†è€…ã¾ã§ã€å®Ÿå‹™ã§å½¹ç«‹ã¤çŸ¥è­˜ã‚’æ®µéšçš„ã«æä¾›ã—ã¾ã™ã€‚

## 6.1 é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®å®Ÿè£…

### 6.1.1 Microsoft Defender for Office 365

#### é«˜åº¦ãªè„…å¨ä¿è­·ã®æ¦‚è¦

**Microsoft Defender for Office 365**ã¯ã€é›»å­ãƒ¡ãƒ¼ãƒ«ã¨ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã«å¯¾ã™ã‚‹é«˜åº¦ãªè„…å¨ä¿è­·ã‚’æä¾›ã—ã¾ã™ã€‚

**ä¸»è¦ãªä¿è­·æ©Ÿèƒ½ï¼š**
- **å®‰å…¨ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«**: ä¸å¯©ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®éš”é›¢ãƒ»åˆ†æ
- **å®‰å…¨ãªãƒªãƒ³ã‚¯**: URLã®å‹•çš„ã‚¹ã‚­ãƒ£ãƒ³ã¨æ›¸ãæ›ãˆ
- **ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°å¯¾ç­–**: é«˜åº¦ãªãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ¤œå‡º
- **ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°å¯¾ç­–**: é€ä¿¡è€…å½è£…ã®æ¤œå‡ºã¨é˜²æ­¢
- **è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹**: æœ€æ–°ã®è„…å¨æƒ…å ±ã®æ´»ç”¨

#### å®‰å…¨ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š

**ğŸ“‹ å®Ÿè·µï¼šå®‰å…¨ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š**

**Microsoft 365 Defender ãƒãƒ¼ã‚¿ãƒ«ã§ã®è¨­å®šï¼š**
1. **Microsoft 365 Defender** (`security.microsoft.com`) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **ãƒ¡ãƒ¼ãƒ« & ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** > **ãƒãƒªã‚·ãƒ¼ã¨è¦å‰‡** > **è„…å¨ãƒãƒªã‚·ãƒ¼**
3. **å®‰å…¨ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ** ã‚’é¸æŠ

**æ¨å¥¨è¨­å®šï¼š**
```
ãƒãƒªã‚·ãƒ¼å: å…¨ç¤¾å“¡å‘ã‘å®‰å…¨ãªæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
è¨­å®š:
â–¡ ä¸æ˜ãªãƒãƒ«ã‚¦ã‚§ã‚¢å¿œç­”: ãƒ–ãƒ­ãƒƒã‚¯
â–¡ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å†æ›¸ãè¾¼ã¿: æœ‰åŠ¹
â–¡ å‹•çš„é…ä¿¡: æœ‰åŠ¹
â–¡ ä¿è­·ã•ã‚ŒãŸæ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: æœ‰åŠ¹
```

#### å®‰å…¨ãªãƒªãƒ³ã‚¯ã®è¨­å®š

**å®‰å…¨ãªãƒªãƒ³ã‚¯**ã¯ã€ãƒ¡ãƒ¼ãƒ«å†…ã®URLã‚’å‹•çš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã€æ‚ªæ„ã®ã‚ã‚‹ãƒªãƒ³ã‚¯ã‹ã‚‰ä¿è­·ã—ã¾ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šå®‰å…¨ãªãƒªãƒ³ã‚¯ã®è¨­å®š**

**è¨­å®šæ‰‹é †ï¼š**
1. **Microsoft 365 Defender** > **å®‰å…¨ãªãƒªãƒ³ã‚¯**
2. **æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ãƒãƒªã‚·ãƒ¼è¨­å®š**:
   - **åå‰**: ã€Œå…¨ç¤¾å“¡å‘ã‘å®‰å…¨ãªãƒªãƒ³ã‚¯ã€
   - **å¯¾è±¡**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
   - **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹ãƒªãƒ³ã‚¯ã‚’æ›¸ãæ›ãˆ
   - **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  URL ã‚¹ã‚­ãƒ£ãƒ³**: æœ‰åŠ¹
   - **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®ç–‘ã‚ã—ã„ãƒªãƒ³ã‚¯**: æœ‰åŠ¹

### 6.1.2 Azure Security Centerï¼ˆMicrosoft Defender for Cloudï¼‰

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ…‹å‹¢ã®ç›£è¦–

**Microsoft Defender for Cloud**ã¯ã€Azureç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ…‹å‹¢ã‚’åŒ…æ‹¬çš„ã«ç›£è¦–ã—ã¾ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½ï¼š**
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: ç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³ã‚’æ•°å€¤åŒ–
- **æ¨å¥¨äº‹é …**: å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ
- **è„…å¨æ¤œå‡º**: ç•°å¸¸ãªæ´»å‹•ã®æ¤œå‡º
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹**: è¦åˆ¶è¦ä»¶ã¸ã®æº–æ‹ çŠ¶æ³

#### æ¨å¥¨äº‹é …ã®å®Ÿè£…

**ğŸ“‹ å®Ÿè·µï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¨å¥¨äº‹é …ã®å®Ÿè£…**

**Azure portalã§ã®ç¢ºèªæ‰‹é †ï¼š**
1. **Azure portal** > **Microsoft Defender for Cloud**
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ…‹å‹¢** ã‚’é¸æŠ
3. **æ¨å¥¨äº‹é …** ã‚¿ãƒ–ã§æ”¹å–„é …ç›®ã‚’ç¢ºèª
4. å„ªå…ˆåº¦ã®é«˜ã„é …ç›®ã‹ã‚‰é †æ¬¡å¯¾å¿œ

**ä¸€èˆ¬çš„ãªæ¨å¥¨äº‹é …ï¼š**
```
é«˜å„ªå…ˆåº¦:
â–¡ ä»®æƒ³ãƒã‚·ãƒ³ã§ Just-In-Time ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’æœ‰åŠ¹åŒ–
â–¡ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å®‰å…¨ãªè»¢é€ã‚’æœ‰åŠ¹åŒ–
â–¡ SQL ã‚µãƒ¼ãƒãƒ¼ã§è„†å¼±æ€§è©•ä¾¡ã‚’æœ‰åŠ¹åŒ–
â–¡ ä»®æƒ³ãƒã‚·ãƒ³ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¿è­·ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä¸­å„ªå…ˆåº¦:
â–¡ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¦å‰‡ã‚’åˆ¶é™
â–¡ ä»®æƒ³ãƒã‚·ãƒ³ã§é©å¿œå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ã‚’æœ‰åŠ¹åŒ–
â–¡ Key Vault ã§è¨ºæ–­ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
```

### 6.1.3 Identity Protectionï¼ˆèº«å…ƒä¿è­·ï¼‰

#### ãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹

**Microsoft Entra ID Identity Protection**ã¯ã€æ©Ÿæ¢°å­¦ç¿’ã‚’æ´»ç”¨ã—ã¦ãƒªã‚¹ã‚¯ã‚’æ¤œå‡ºã—ã€è‡ªå‹•çš„ã«å¯¾å¿œã—ã¾ã™ã€‚

**æ¤œå‡ºã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ï¼š**
- **åŒ¿åIPã‚¢ãƒ‰ãƒ¬ã‚¹**: Tor ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãªã©ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
- **éå®šå‹ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³**: æ™®æ®µã¨ç•°ãªã‚‹å ´æ‰€ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
- **ãƒãƒ«ã‚¦ã‚§ã‚¢ãƒªãƒ³ã‚¯**: æ„ŸæŸ“ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
- **æ¼æ´©ã—ãŸè³‡æ ¼æƒ…å ±**: å…¬é–‹ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ

**ğŸ“‹ å®Ÿè·µï¼šãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹è¨­å®š**

**è¨­å®šæ‰‹é †ï¼š**
1. **Microsoft Entra ID** > **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** > **Identity Protection**
2. **æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹** > **æ–°ã—ã„ãƒãƒªã‚·ãƒ¼**
3. **ãƒãƒªã‚·ãƒ¼è¨­å®š**:
   - **åå‰**: ã€Œãƒªã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€
   - **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
   - **æ¡ä»¶**: ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒªã‚¹ã‚¯ã€Œä¸­ã€ä»¥ä¸Š
   - **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: MFA ã‚’è¦æ±‚

**ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«åˆ¥ã®å¯¾å¿œï¼š**
```
ä½ãƒªã‚¹ã‚¯:
- é€šå¸¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯
- è¿½åŠ ã®èªè¨¼ä¸è¦

ä¸­ãƒªã‚¹ã‚¯:
- å¤šè¦ç´ èªè¨¼ã‚’è¦æ±‚
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’æ¨å¥¨

é«˜ãƒªã‚¹ã‚¯:
- ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
- ç®¡ç†è€…ã¸ã®é€šçŸ¥
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ
```

## 6.2 ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç®¡ç†ã®å®Ÿè£…

### 6.2.1 ãƒ‡ãƒ¼ã‚¿ä¿è­·ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

#### Microsoft Purview ã®æ´»ç”¨

**Microsoft Purview**ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®åˆ†é¡ã€ä¿è­·ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ã‚’çµ±åˆçš„ã«ç®¡ç†ã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½ï¼š**
- **ãƒ‡ãƒ¼ã‚¿åˆ†é¡**: æ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«ã®è‡ªå‹•é©ç”¨
- **ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ï¼ˆDLPï¼‰**: æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®æµå‡ºé˜²æ­¢
- **æƒ…å ±ã‚¬ãƒãƒŠãƒ³ã‚¹**: ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒã¨å‰Šé™¤
- **ã‚¤ãƒ³ã‚µã‚¤ãƒ€ãƒ¼ãƒªã‚¹ã‚¯ç®¡ç†**: å†…éƒ¨è„…å¨ã®æ¤œå‡º

#### æ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«ã®è¨­å®š

**ğŸ“‹ å®Ÿè·µï¼šæ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«ã®è¨­å®š**

**Microsoft Purview ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ ãƒãƒ¼ã‚¿ãƒ«ã§ã®è¨­å®šï¼š**
1. **Microsoft Purview** (`compliance.microsoft.com`) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. **æƒ…å ±ä¿è­·** > **æ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«**
3. **ãƒ©ãƒ™ãƒ«ã®ä½œæˆ** ã‚’ã‚¯ãƒªãƒƒã‚¯

**æ¨å¥¨ãƒ©ãƒ™ãƒ«æ§‹æˆï¼š**
```
æ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«:
1. ãƒ‘ãƒ–ãƒªãƒƒã‚¯
   - ä¿è­·: ãªã—
   - ç”¨é€”: ä¸€èˆ¬å…¬é–‹å¯èƒ½ãªæƒ…å ±

2. ç¤¾å†…
   - ä¿è­·: æš—å·åŒ–ï¼ˆçµ„ç¹”å†…ã®ã¿ï¼‰
   - ç”¨é€”: ç¤¾å†…é™å®šæƒ…å ±

3. æ©Ÿå¯†
   - ä¿è­·: æš—å·åŒ–ï¼ˆæŒ‡å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼‰
   - ç”¨é€”: æ©Ÿå¯†æƒ…å ±ï¼ˆå¥‘ç´„æ›¸ã€è²¡å‹™æƒ…å ±ç­‰ï¼‰

4. æ¥µç§˜
   - ä¿è­·: æš—å·åŒ–ï¼ˆå½¹å“¡ã®ã¿ï¼‰
   - ç”¨é€”: æœ€é«˜æ©Ÿå¯†æƒ…å ±
```

#### ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢ï¼ˆDLPï¼‰ãƒãƒªã‚·ãƒ¼

**DLP ãƒãƒªã‚·ãƒ¼**ã¯ã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®ä¸æ­£ãªå…±æœ‰ã‚„æµå‡ºã‚’é˜²æ­¢ã—ã¾ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šDLP ãƒãƒªã‚·ãƒ¼ã®è¨­å®š**

**è¨­å®šæ‰‹é †ï¼š**
1. **Microsoft Purview** > **ãƒ‡ãƒ¼ã‚¿æå¤±é˜²æ­¢** > **ãƒãƒªã‚·ãƒ¼**
2. **ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: ã€Œæ—¥æœ¬ã®å€‹äººæƒ…å ±ä¿è­·æ³•ã€ã‚’é¸æŠ

**åŸºæœ¬çš„ãª DLP ãƒãƒªã‚·ãƒ¼è¨­å®šï¼š**
```
ãƒãƒªã‚·ãƒ¼å: å€‹äººæƒ…å ±ä¿è­·
å¯¾è±¡å ´æ‰€: Exchange Online, SharePoint Online, Teams
æ¤œå‡ºæ¡ä»¶:
â–¡ æ—¥æœ¬ã®å€‹äººç•ªå·ï¼ˆãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ï¼‰
â–¡ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·
â–¡ éŠ€è¡Œå£åº§ç•ªå·

ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:
â–¡ å¤–éƒ¨å…±æœ‰æ™‚: ãƒ–ãƒ­ãƒƒã‚¯
â–¡ å†…éƒ¨å…±æœ‰æ™‚: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è­¦å‘Š
â–¡ ç®¡ç†è€…é€šçŸ¥: æœ‰åŠ¹
```

### 6.2.2 æƒ…å ±ã‚¬ãƒãƒŠãƒ³ã‚¹

#### ä¿æŒãƒãƒªã‚·ãƒ¼ã®è¨­å®š

**ä¿æŒãƒãƒªã‚·ãƒ¼**ã¯ã€ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒæœŸé–“ã¨å‰Šé™¤ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šä¿æŒãƒãƒªã‚·ãƒ¼ã®è¨­å®š**

**è¨­å®šæ‰‹é †ï¼š**
1. **Microsoft Purview** > **æƒ…å ±ã‚¬ãƒãƒŠãƒ³ã‚¹** > **ä¿æŒãƒãƒªã‚·ãƒ¼**
2. **æ–°ã—ã„ä¿æŒãƒãƒªã‚·ãƒ¼** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **å ´æ‰€ã®é¸æŠ**: Exchange, SharePoint, Teams ã‚’é¸æŠ

**æ¥­å‹™åˆ¥ä¿æŒãƒãƒªã‚·ãƒ¼ï¼š**
```
ä¼šè¨ˆé–¢é€£æ–‡æ›¸:
- ä¿æŒæœŸé–“: 7å¹´
- ä¿æŒå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å‰Šé™¤

äººäº‹é–¢é€£æ–‡æ›¸:
- ä¿æŒæœŸé–“: 5å¹´
- ä¿æŒå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å‰Šé™¤

å–¶æ¥­é–¢é€£æ–‡æ›¸:
- ä¿æŒæœŸé–“: 3å¹´
- ä¿æŒå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å‰Šé™¤

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–‡æ›¸:
- ä¿æŒæœŸé–“: 2å¹´
- ä¿æŒå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å‰Šé™¤
```

#### é›»å­æƒ…å ±é–‹ç¤ºï¼ˆeDiscoveryï¼‰

**eDiscovery**ã¯ã€æ³•çš„è¦è«‹ã‚„å†…éƒ¨èª¿æŸ»ã«å¯¾å¿œã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šeDiscovery ã®åŸºæœ¬è¨­å®š**

**è¨­å®šæ‰‹é †ï¼š**
1. **Microsoft Purview** > **eDiscovery** > **Core**
2. **æ–°ã—ã„ã‚±ãƒ¼ã‚¹** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **ã‚±ãƒ¼ã‚¹æƒ…å ±**: åå‰ã€èª¬æ˜ã€ä¿ç®¡æ‹…å½“è€…ã‚’è¨­å®š

**eDiscovery ãƒ—ãƒ­ã‚»ã‚¹ï¼š**
```
1. ã‚±ãƒ¼ã‚¹ä½œæˆ
   - èª¿æŸ»ç›®çš„ã®æ˜ç¢ºåŒ–
   - é–¢ä¿‚è€…ã®ç‰¹å®š
   - æœŸé–“ã®è¨­å®š

2. ãƒ›ãƒ¼ãƒ«ãƒ‰ã®è¨­å®š
   - å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ã®ä¿æŒ
   - è‡ªå‹•å‰Šé™¤ã®åœæ­¢
   - å¤‰æ›´ã®é˜²æ­¢

3. æ¤œç´¢ã®å®Ÿè¡Œ
   - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
   - æ—¥ä»˜ç¯„å›²æŒ‡å®š
   - å¯¾è±¡è€…ã®æŒ‡å®š

4. ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - æ¤œç´¢çµæœã®å‡ºåŠ›
   - æ³•çš„å½¢å¼ã§ã®ä¿å­˜
   - è¨¼æ‹ ä¿å…¨
```

### 6.2.3 ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è©•ä¾¡

#### ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

**Microsoft Purview ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**ã¯ã€çµ„ç¹”ã®ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çŠ¶æ³ã‚’è©•ä¾¡ãƒ»ç®¡ç†ã—ã¾ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½ï¼š**
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚¹ã‚³ã‚¢**: æº–æ‹ çŠ¶æ³ã®æ•°å€¤åŒ–
- **æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ
- **è©•ä¾¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: å„ç¨®è¦åˆ¶ã¸ã®å¯¾å¿œ
- **è¨¼æ‹ ç®¡ç†**: ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¨¼æ‹ ã®ä¿å­˜

**ğŸ“‹ å®Ÿè·µï¼šã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è©•ä¾¡ã®å®Ÿæ–½**

**è©•ä¾¡æ‰‹é †ï¼š**
1. **Microsoft Purview** > **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**
2. **è©•ä¾¡** > **è©•ä¾¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã‹ã‚‰é©åˆ‡ãªè¦åˆ¶ã‚’é¸æŠ
3. **æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã‚’ç¢ºèªã—ã€å„ªå…ˆåº¦é †ã«å®Ÿè£…

**æ—¥æœ¬ä¼æ¥­å‘ã‘é‡è¦è¦åˆ¶ï¼š**
```
å€‹äººæƒ…å ±ä¿è­·æ³•:
â–¡ å€‹äººãƒ‡ãƒ¼ã‚¿ã®é©åˆ‡ãªå–æ‰±ã„
â–¡ å®‰å…¨ç®¡ç†æªç½®ã®å®Ÿæ–½
â–¡ æœ¬äººåŒæ„ã®å–å¾—
â–¡ ç¬¬ä¸‰è€…æä¾›ã®åˆ¶é™

ä¸æ­£ç«¶äº‰é˜²æ­¢æ³•:
â–¡ å–¶æ¥­ç§˜å¯†ã®ä¿è­·
â–¡ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…
â–¡ å¾“æ¥­å“¡æ•™è‚²ã®å®Ÿæ–½

é›»å­å¸³ç°¿ä¿å­˜æ³•:
â–¡ é›»å­ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜è¦ä»¶
â–¡ æ¤œç´¢æ©Ÿèƒ½ã®æä¾›
â–¡ æ”¹ã–ã‚“é˜²æ­¢æªç½®
```

## 6.3 ç›£æŸ»ã¨ãƒ­ã‚°ç®¡ç†

### 6.3.1 çµ±åˆç›£æŸ»ãƒ­ã‚°

#### ç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

**çµ±åˆç›£æŸ»ãƒ­ã‚°**ã¯ã€Microsoft 365 å…¨ä½“ã®æ´»å‹•ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šçµ±åˆç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–**

**PowerShell ã§ã®è¨­å®šï¼š**
```powershell
# Exchange Online PowerShell ã§æ¥ç¶š
Connect-ExchangeOnline

# çµ±åˆç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–
Set-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true

# è¨­å®šã®ç¢ºèª
Get-AdminAuditLogConfig
```

**ç›£æŸ»å¯¾è±¡ã®æ´»å‹•ï¼š**
```
Exchange Online:
â–¡ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
â–¡ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡
â–¡ ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®æ“ä½œ
â–¡ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹è¨­å®šã®å¤‰æ›´

SharePoint Online:
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ãƒ»å‰Šé™¤
â–¡ å…±æœ‰è¨­å®šã®å¤‰æ›´
â–¡ ã‚µã‚¤ãƒˆè¨­å®šã®å¤‰æ›´

Microsoft Teams:
â–¡ ãƒãƒ¼ãƒ ã®ä½œæˆãƒ»å‰Šé™¤
â–¡ ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤
â–¡ ä¼šè­°ã®ä½œæˆãƒ»å‚åŠ 
â–¡ ãƒ•ã‚¡ã‚¤ãƒ«ã®å…±æœ‰

Microsoft Entra ID:
â–¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³
â–¡ ç®¡ç†è€…ã®æ“ä½œ
â–¡ æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹
â–¡ MFA ã®ä½¿ç”¨
```

### 6.3.2 ç›£æŸ»ãƒ­ã‚°ã®åˆ†æ

#### åŸºæœ¬çš„ãªç›£æŸ»ãƒ­ã‚°æ¤œç´¢

**ğŸ“‹ å®Ÿè·µï¼šç›£æŸ»ãƒ­ã‚°ã®æ¤œç´¢**

**Microsoft Purview ã§ã®æ¤œç´¢ï¼š**
1. **Microsoft Purview** > **ç›£æŸ»**
2. **æ¤œç´¢** ã‚¿ãƒ–ã§æ¡ä»¶ã‚’è¨­å®š
3. **æ¤œç´¢** ã‚’ã‚¯ãƒªãƒƒã‚¯

**PowerShell ã§ã®æ¤œç´¢ï¼š**
```powershell
# éå»7æ—¥é–“ã®ç®¡ç†è€…æ´»å‹•ã‚’æ¤œç´¢
$results = Search-UnifiedAuditLog -StartDate (Get-Date).AddDays(-7) -EndDate (Get-Date) -RecordType ExchangeAdmin

# çµæœã®è¡¨ç¤º
$results | Select-Object CreationDate, UserIds, Operations | Format-Table

# ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ´»å‹•ã‚’æ¤œç´¢
$userResults = Search-UnifiedAuditLog -StartDate (Get-Date).AddDays(-7) -EndDate (Get-Date) -UserIds "user@contoso.com"

# CSVãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
$userResults | Export-Csv -Path "C:\Audit\UserActivity.csv" -NoTypeInformation
```

#### é«˜åº¦ãªç›£æŸ»ãƒ­ã‚°åˆ†æ

**ğŸ“‹ å®Ÿè·µï¼šé«˜åº¦ãªç›£æŸ»ãƒ­ã‚°åˆ†æ**

```powershell
# ç–‘ã‚ã—ã„æ´»å‹•ã®æ¤œå‡ºã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Find-SuspiciousActivity {
    param(
        [int]$Days = 7,
        [string]$OutputPath = "C:\Audit\"
    )
    
    $startDate = (Get-Date).AddDays(-$Days)
    $endDate = Get-Date
    
    # 1. ç•°å¸¸ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³æ´»å‹•
    Write-Host "ç•°å¸¸ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³æ´»å‹•ã‚’æ¤œç´¢ä¸­..." -ForegroundColor Yellow
    $suspiciousSignins = Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -Operations "UserLoggedIn" | 
                        Where-Object { $_.AuditData -like "*RiskState*" }
    
    # 2. å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    Write-Host "å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’æ¤œç´¢ä¸­..." -ForegroundColor Yellow
    $downloads = Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -Operations "FileDownloaded"
    $suspiciousDownloads = $downloads | Group-Object UserIds | Where-Object { $_.Count -gt 50 }
    
    # 3. ç®¡ç†è€…æ¨©é™ã®å¤‰æ›´
    Write-Host "ç®¡ç†è€…æ¨©é™ã®å¤‰æ›´ã‚’æ¤œç´¢ä¸­..." -ForegroundColor Yellow
    $adminChanges = Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -Operations "Add member to role", "Remove member from role"
    
    # 4. å¤–éƒ¨å…±æœ‰ã®æ´»å‹•
    Write-Host "å¤–éƒ¨å…±æœ‰ã®æ´»å‹•ã‚’æ¤œç´¢ä¸­..." -ForegroundColor Yellow
    $externalSharing = Search-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -Operations "SharingInvitationCreated", "AnonymousLinkCreated"
    
    # ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
    $report = @"
ç–‘ã‚ã—ã„æ´»å‹•ãƒ¬ãƒãƒ¼ãƒˆ
ç”Ÿæˆæ—¥æ™‚: $(Get-Date)
å¯¾è±¡æœŸé–“: $($startDate.ToString('yyyy-MM-dd')) ï½ $($endDate.ToString('yyyy-MM-dd'))

1. ç•°å¸¸ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³: $($suspiciousSignins.Count) ä»¶
2. å¤§é‡ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: $($suspiciousDownloads.Count) ãƒ¦ãƒ¼ã‚¶ãƒ¼
3. ç®¡ç†è€…æ¨©é™å¤‰æ›´: $($adminChanges.Count) ä»¶
4. å¤–éƒ¨å…±æœ‰: $($externalSharing.Count) ä»¶
"@
    
    $report | Out-File -FilePath "$OutputPath\SuspiciousActivity_$(Get-Date -Format 'yyyyMMdd').txt"
    
    # è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ›
    $suspiciousSignins | Export-Csv -Path "$OutputPath\SuspiciousSignins.csv" -NoTypeInformation
    $suspiciousDownloads | Export-Csv -Path "$OutputPath\SuspiciousDownloads.csv" -NoTypeInformation
    $adminChanges | Export-Csv -Path "$OutputPath\AdminChanges.csv" -NoTypeInformation
    $externalSharing | Export-Csv -Path "$OutputPath\ExternalSharing.csv" -NoTypeInformation
    
    Write-Host "ç–‘ã‚ã—ã„æ´»å‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: $OutputPath" -ForegroundColor Green
}

# å®Ÿè¡Œä¾‹
Find-SuspiciousActivity -Days 30 -OutputPath "C:\SecurityAudit\"
```

### 6.3.3 Microsoft Sentinel ã¨ã®é€£æº

#### Microsoft Sentinel ã®åŸºæœ¬è¨­å®š

**Microsoft Sentinel**ã¯ã€AI ã‚’æ´»ç”¨ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ãŠã‚ˆã³ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ï¼ˆSIEMï¼‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

**ğŸ“‹ å®Ÿè·µï¼šMicrosoft Sentinel ã®åŸºæœ¬è¨­å®š**

**Azure portal ã§ã®è¨­å®šï¼š**
1. **Azure portal** > **Microsoft Sentinel**
2. **æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹** ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **Log Analytics ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹** ã‚’ä½œæˆ
4. **Microsoft Sentinel** ã‚’è¿½åŠ 

**ãƒ‡ãƒ¼ã‚¿ã‚³ãƒã‚¯ã‚¿ã®è¨­å®šï¼š**
```
æ¨å¥¨ãƒ‡ãƒ¼ã‚¿ã‚³ãƒã‚¯ã‚¿:
â–¡ Office 365 (ç›£æŸ»ãƒ­ã‚°)
â–¡ Azure Activity (Azure ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£)
â–¡ Azure AD (èªè¨¼ãƒ­ã‚°)
â–¡ Microsoft Defender for Office 365
â–¡ Microsoft Defender for Cloud
â–¡ Microsoft Defender for Identity
```

#### ã‚«ã‚¹ã‚¿ãƒ æ¤œå‡ºãƒ«ãƒ¼ãƒ«ã®ä½œæˆ

**ğŸ“‹ å®Ÿè·µï¼šã‚«ã‚¹ã‚¿ãƒ æ¤œå‡ºãƒ«ãƒ¼ãƒ«ã®ä½œæˆ**

**KQLï¼ˆKusto Query Languageï¼‰ã§ã®æ¤œå‡ºãƒ«ãƒ¼ãƒ«ä¾‹ï¼š**

```kusto
// è¤‡æ•°å›ã®å¤±æ•—ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®æˆåŠŸãƒ­ã‚°ã‚¤ãƒ³
SigninLogs
| where TimeGenerated > ago(1h)
| where ResultType != "0"
| summarize FailedCount = count() by UserPrincipalName, bin(TimeGenerated, 5m)
| where FailedCount >= 5
| join (
    SigninLogs
    | where TimeGenerated > ago(1h)
    | where ResultType == "0"
) on UserPrincipalName
| project UserPrincipalName, FailedCount, SuccessTime = TimeGenerated1, IPAddress
```

```kusto
// ç•°å¸¸ãªå¤§é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
OfficeActivity
| where TimeGenerated > ago(24h)
| where Operation == "FileDownloaded"
| summarize DownloadCount = count() by UserId, bin(TimeGenerated, 1h)
| where DownloadCount > 100
| project UserId, DownloadCount, TimeGenerated
```

#### ã‚¢ãƒ©ãƒ¼ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**ğŸ“‹ å®Ÿè·µï¼šã‚¢ãƒ©ãƒ¼ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹**

**è‡ªå‹•å¿œç­”ã®è¨­å®šï¼š**
```
ã‚¢ãƒ©ãƒ¼ãƒˆ: å¤§é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
æ¡ä»¶: 1æ™‚é–“ã«100ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Šã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
è‡ªå‹•å¿œç­”:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¸€æ™‚åœæ­¢
2. ç®¡ç†è€…ã¸ã®é€šçŸ¥
3. ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ä½œæˆ
4. ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯èª¿æŸ»ã®é–‹å§‹
```

## 6.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨ã®è‡ªå‹•åŒ–

### 6.4.1 PowerShell ã«ã‚ˆã‚‹è‡ªå‹•åŒ–

#### å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

**ğŸ“‹ å®Ÿè·µï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®è‡ªå‹•åŒ–**

```powershell
# å®šæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Invoke-SecurityCheck {
    param(
        [string]$OutputPath = "C:\SecurityReports\",
        [string]$EmailTo = "security@company.com"
    )
    
    $checkDate = Get-Date
    $reportPath = "$OutputPath\SecurityCheck_$($checkDate.ToString('yyyyMMdd')).html"
    
    # å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ
    if (-not (Test-Path $OutputPath)) {
        New-Item -ItemType Directory -Path $OutputPath -Force
    }
    
    # HTML ãƒ¬ãƒãƒ¼ãƒˆã®é–‹å§‹
    $html = @"
<!DOCTYPE html>
<html>
<head>
    <title>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .section { margin: 20px 0; }
        .good { color: #27ae60; }
        .warning { color: #f39c12; }
        .error { color: #e74c3c; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1 class="header">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ</h1>
    <p>ç”Ÿæˆæ—¥æ™‚: $($checkDate.ToString('yyyyå¹´MMæœˆddæ—¥ HH:mm:ss'))</p>
"@
    
    # 1. MFAæœ‰åŠ¹åŒ–çŠ¶æ³
    Write-Host "MFAæœ‰åŠ¹åŒ–çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..." -ForegroundColor Yellow
    $html += "<div class='section'><h2>å¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰æœ‰åŠ¹åŒ–çŠ¶æ³</h2>"
    
    try {
        Connect-MgGraph -Scopes "User.Read.All" -NoWelcome
        $users = Get-MgUser -All
        $mfaEnabled = 0
        $mfaDisabled = 0
        
        foreach ($user in $users) {
            $authMethods = Get-MgUserAuthenticationMethod -UserId $user.Id
            if ($authMethods) {
                $mfaEnabled++
            } else {
                $mfaDisabled++
            }
        }
        
        $mfaPercentage = [math]::Round(($mfaEnabled / $users.Count) * 100, 2)
        
        if ($mfaPercentage -ge 95) {
            $html += "<p class='good'>âœ“ MFAæœ‰åŠ¹åŒ–ç‡: $mfaPercentage% ï¼ˆè‰¯å¥½ï¼‰</p>"
        } elseif ($mfaPercentage -ge 80) {
            $html += "<p class='warning'>âš  MFAæœ‰åŠ¹åŒ–ç‡: $mfaPercentage% ï¼ˆè¦æ³¨æ„ï¼‰</p>"
        } else {
            $html += "<p class='error'>âœ— MFAæœ‰åŠ¹åŒ–ç‡: $mfaPercentage% ï¼ˆè¦æ”¹å–„ï¼‰</p>"
        }
        
        $html += "<p>MFAæœ‰åŠ¹: $mfaEnabled ãƒ¦ãƒ¼ã‚¶ãƒ¼</p>"
        $html += "<p>MFAç„¡åŠ¹: $mfaDisabled ãƒ¦ãƒ¼ã‚¶ãƒ¼</p>"
    }
    catch {
        $html += "<p class='error'>MFAçŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)</p>"
    }
    
    $html += "</div>"
    
    # 2. æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼
    Write-Host "æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..." -ForegroundColor Yellow
    $html += "<div class='section'><h2>æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼</h2>"
    
    try {
        $policies = Get-MgIdentityConditionalAccessPolicy
        $enabledPolicies = $policies | Where-Object { $_.State -eq "enabled" }
        
        if ($enabledPolicies.Count -gt 0) {
            $html += "<p class='good'>âœ“ æœ‰åŠ¹ãªæ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼: $($enabledPolicies.Count) ä»¶</p>"
            $html += "<table><tr><th>ãƒãƒªã‚·ãƒ¼å</th><th>çŠ¶æ…‹</th></tr>"
            foreach ($policy in $enabledPolicies) {
                $html += "<tr><td>$($policy.DisplayName)</td><td>$($policy.State)</td></tr>"
            }
            $html += "</table>"
        } else {
            $html += "<p class='error'>âœ— æœ‰åŠ¹ãªæ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>"
        }
    }
    catch {
        $html += "<p class='error'>æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)</p>"
    }
    
    $html += "</div>"
    
    # 3. æœ€è¿‘ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—
    Write-Host "æœ€è¿‘ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..." -ForegroundColor Yellow
    $html += "<div class='section'><h2>æœ€è¿‘ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ï¼ˆéå»24æ™‚é–“ï¼‰</h2>"
    
    try {
        $signInLogs = Get-MgAuditLogSignIn -Top 1000 | Where-Object { 
            $_.CreatedDateTime -gt (Get-Date).AddDays(-1) -and 
            $_.Status.ErrorCode -ne 0 
        }
        
        if ($signInLogs.Count -gt 0) {
            $failuresByUser = $signInLogs | Group-Object UserPrincipalName | Sort-Object Count -Descending | Select-Object -First 10
            
            if ($failuresByUser[0].Count -gt 10) {
                $html += "<p class='warning'>âš  æ³¨æ„: è¤‡æ•°å›ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ</p>"
            } else {
                $html += "<p class='good'>âœ“ ç•°å¸¸ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ã¯æ¤œå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“</p>"
            }
            
            $html += "<table><tr><th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th><th>å¤±æ•—å›æ•°</th></tr>"
            foreach ($failure in $failuresByUser) {
                $html += "<tr><td>$($failure.Name)</td><td>$($failure.Count)</td></tr>"
            }
            $html += "</table>"
        } else {
            $html += "<p class='good'>âœ“ éå»24æ™‚é–“ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ã¯ã‚ã‚Šã¾ã›ã‚“</p>"
        }
    }
    catch {
        $html += "<p class='error'>ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)</p>"
    }
    
    $html += "</div>"
    
    # 4. å¤–éƒ¨å…±æœ‰ã®çŠ¶æ³
    Write-Host "å¤–éƒ¨å…±æœ‰ã®çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..." -ForegroundColor Yellow
    $html += "<div class='section'><h2>å¤–éƒ¨å…±æœ‰ã®çŠ¶æ³</h2>"
    
    try {
        # SharePoint Online ç®¡ç†ã‚·ã‚§ãƒ«ãŒå¿…è¦
        # ã“ã®éƒ¨åˆ†ã¯å®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´
        $html += "<p>å¤–éƒ¨å…±æœ‰ã®è©³ç´°ãƒã‚§ãƒƒã‚¯ã¯ç®¡ç†è€…ãŒæ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„</p>"
    }
    catch {
        $html += "<p class='error'>å¤–éƒ¨å…±æœ‰çŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)</p>"
    }
    
    $html += "</div>"
    
    # ãƒ¬ãƒãƒ¼ãƒˆã®çµ‚äº†
    $html += @"
    <div class='section'>
        <h2>æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
        <ul>
            <li>MFAæœ‰åŠ¹åŒ–ç‡ãŒ95%ã‚’ä¸‹å›ã‚‹å ´åˆã¯ã€æœªè¨­å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦è¨­å®šã‚’ä¿ƒã—ã¦ãã ã•ã„</li>
            <li>æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€åŸºæœ¬çš„ãªãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„</li>
            <li>ç•°å¸¸ãªã‚µã‚¤ãƒ³ã‚¤ãƒ³å¤±æ•—ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã¯ã€è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã—ã¦ãã ã•ã„</li>
            <li>å¤–éƒ¨å…±æœ‰ãŒéåº¦ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒãƒªã‚·ãƒ¼ã®è¦‹ç›´ã—ã‚’æ¤œè¨ã—ã¦ãã ã•ã„</li>
        </ul>
    </div>
    <p><em>ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚è©³ç´°ãªèª¿æŸ»ãŒå¿…è¦ãªå ´åˆã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</em></p>
</body>
</html>
"@
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    $html | Out-File -FilePath $reportPath -Encoding UTF8
    
    # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if ($EmailTo) {
        try {
            $subject = "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ - $($checkDate.ToString('yyyy-MM-dd'))"
            $body = "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆã‚’æ·»ä»˜ã„ãŸã—ã¾ã™ã€‚è©³ç´°ã¯æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"
            
            # Send-MailMessage ã®å®Ÿè£…ã¯ç’°å¢ƒã«å¿œã˜ã¦èª¿æ•´
            # Send-MailMessage -To $EmailTo -Subject $subject -Body $body -Attachments $reportPath
            
            Write-Host "ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ: $reportPath" -ForegroundColor Green
        }
        catch {
            Write-Host "ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)" -ForegroundColor Red
        }
    }
    
    Write-Host "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Œäº†: $reportPath" -ForegroundColor Green
}

# å®Ÿè¡Œä¾‹
Invoke-SecurityCheck -OutputPath "C:\SecurityReports\" -EmailTo "security@company.com"
```

### 6.4.2 ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã®è‡ªå‹•åŒ–

#### è‡ªå‹•ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

**ğŸ“‹ å®Ÿè·µï¼šè‡ªå‹•ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ**

```powershell
# ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Invoke-SecurityIncidentResponse {
    param(
        [string]$IncidentType,
        [string]$UserId,
        [string]$Details
    )
    
    $incidentId = New-Guid
    $timestamp = Get-Date
    
    Write-Host "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹" -ForegroundColor Red
    Write-Host "ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID: $incidentId" -ForegroundColor Yellow
    Write-Host "ç¨®åˆ¥: $IncidentType" -ForegroundColor Yellow
    Write-Host "å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: $UserId" -ForegroundColor Yellow
    
    switch ($IncidentType) {
        "SuspiciousLogin" {
            # ç–‘ã‚ã—ã„ãƒ­ã‚°ã‚¤ãƒ³ã®å¯¾å¿œ
            Write-Host "ç–‘ã‚ã—ã„ãƒ­ã‚°ã‚¤ãƒ³ã«å¯¾ã™ã‚‹å¯¾å¿œã‚’å®Ÿè¡Œä¸­..." -ForegroundColor Yellow
            
            # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–
            try {
                Revoke-MgUserSignInSession -UserId $UserId
                Write-Host "âœ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ" -ForegroundColor Green
            }
            catch {
                Write-Host "âœ— ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ã«å¤±æ•—: $($_.Exception.Message)" -ForegroundColor Red
            }
            
            # 2. æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹ä¸€æ™‚ãƒ–ãƒ­ãƒƒã‚¯
            # å®Ÿè£…ã¯æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®è¨­å®šã«ä¾å­˜
            
            # 3. ç®¡ç†è€…ã¸ã®é€šçŸ¥
            $subject = "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆ: ç–‘ã‚ã—ã„ãƒ­ã‚°ã‚¤ãƒ³"
            $body = @"
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID: $incidentId
ç¨®åˆ¥: ç–‘ã‚ã—ã„ãƒ­ã‚°ã‚¤ãƒ³
å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: $UserId
ç™ºç”Ÿæ™‚åˆ»: $timestamp
è©³ç´°: $Details

å¯¾å¿œæ¸ˆã¿:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–

è¦å¯¾å¿œ:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ç¢ºèª
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã®æ¤œè¨
- è¿½åŠ èª¿æŸ»ã®å®Ÿæ–½
"@
            
            # ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†ï¼ˆç’°å¢ƒã«å¿œã˜ã¦å®Ÿè£…ï¼‰
            Write-Host "âœ“ ç®¡ç†è€…ã¸ã®é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ" -ForegroundColor Green
        }
        
        "MassDownload" {
            # å¤§é‡ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®å¯¾å¿œ
            Write-Host "å¤§é‡ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹å¯¾å¿œã‚’å®Ÿè¡Œä¸­..." -ForegroundColor Yellow
            
            # 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€æ™‚åœæ­¢
            try {
                Update-MgUser -UserId $UserId -AccountEnabled:$false
                Write-Host "âœ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ" -ForegroundColor Green
            }
            catch {
                Write-Host "âœ— ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢ã«å¤±æ•—: $($_.Exception.Message)" -ForegroundColor Red
            }
            
            # 2. ç®¡ç†è€…ã¸ã®ç·Šæ€¥é€šçŸ¥
            $subject = "ç·Šæ€¥: å¤§é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¤œå‡º"
            $body = @"
ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID: $incidentId
ç¨®åˆ¥: å¤§é‡ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼: $UserId
ç™ºç”Ÿæ™‚åˆ»: $timestamp
è©³ç´°: $Details

å¯¾å¿œæ¸ˆã¿:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¸€æ™‚åœæ­¢

è¦å¯¾å¿œ:
- ç·Šæ€¥èª¿æŸ»ã®å®Ÿæ–½
- å½±éŸ¿ç¯„å›²ã®ç¢ºèª
- æ³•çš„å¯¾å¿œã®æ¤œè¨
"@
            
            Write-Host "âœ“ ç·Šæ€¥é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ" -ForegroundColor Green
        }
        
        "PrivilegeEscalation" {
            # æ¨©é™æ˜‡æ ¼ã®å¯¾å¿œ
            Write-Host "æ¨©é™æ˜‡æ ¼ã«å¯¾ã™ã‚‹å¯¾å¿œã‚’å®Ÿè¡Œä¸­..." -ForegroundColor Yellow
            
            # 1. å¤‰æ›´ã®è¨˜éŒ²
            $auditLog = @{
                IncidentId = $incidentId
                Type = $IncidentType
                UserId = $UserId
                Timestamp = $timestamp
                Details = $Details
                Response = "Privilege escalation detected and logged"
            }
            
            # 2. ç®¡ç†è€…ã¸ã®å³åº§ã®é€šçŸ¥
            Write-Host "âœ“ æ¨©é™æ˜‡æ ¼ã‚’è¨˜éŒ²ã—ã€ç®¡ç†è€…ã«é€šçŸ¥ã—ã¾ã—ãŸ" -ForegroundColor Green
        }
        
        default {
            Write-Host "æœªçŸ¥ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚¿ã‚¤ãƒ—: $IncidentType" -ForegroundColor Red
        }
    }
    
    # ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ­ã‚°ã®è¨˜éŒ²
    $logEntry = @{
        IncidentId = $incidentId
        Timestamp = $timestamp
        Type = $IncidentType
        UserId = $UserId
        Details = $Details
        Status = "Responded"
    }
    
    $logPath = "C:\SecurityLogs\Incidents_$((Get-Date).ToString('yyyyMM')).json"
    
    # ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
    if (-not (Test-Path (Split-Path $logPath -Parent))) {
        New-Item -ItemType Directory -Path (Split-Path $logPath -Parent) -Force
    }
    
    # ãƒ­ã‚°ã®è¿½è¨˜
    $logEntry | ConvertTo-Json | Add-Content -Path $logPath
    
    Write-Host "ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œå®Œäº†: $incidentId" -ForegroundColor Green
}

# ä½¿ç”¨ä¾‹
# Invoke-SecurityIncidentResponse -IncidentType "SuspiciousLogin" -UserId "user@contoso.com" -Details "ç•°å¸¸ãªåœ°åŸŸã‹ã‚‰ã®ãƒ­ã‚°ã‚¤ãƒ³"
```

## 6.5 ç¶™ç¶šçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„

### 6.5.1 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŒ‡æ¨™ã®ç›£è¦–

#### KPIï¼ˆé‡è¦æ¥­ç¸¾è©•ä¾¡æŒ‡æ¨™ï¼‰ã®è¨­å®š

**ğŸ“‹ å®Ÿè·µï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£KPIã®è¨­å®š**

```powershell
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£KPIæ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Measure-SecurityKPIs {
    param(
        [string]$OutputPath = "C:\SecurityReports\KPI\"
    )
    
    $measurementDate = Get-Date
    $reportPath = "$OutputPath\SecurityKPI_$($measurementDate.ToString('yyyyMMdd')).json"
    
    # å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ
    if (-not (Test-Path $OutputPath)) {
        New-Item -ItemType Directory -Path $OutputPath -Force
    }
    
    Write-Host "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£KPIã‚’æ¸¬å®šä¸­..." -ForegroundColor Yellow
    
    $kpis = @{}
    
    try {
        # 1. MFAå°å…¥ç‡
        Connect-MgGraph -Scopes "User.Read.All" -NoWelcome
        $users = Get-MgUser -All
        $mfaEnabledUsers = 0
        
        foreach ($user in $users) {
            $authMethods = Get-MgUserAuthenticationMethod -UserId $user.Id
            if ($authMethods.Count -gt 1) {  # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»¥å¤–ã®èªè¨¼æ–¹æ³•ãŒã‚ã‚‹
                $mfaEnabledUsers++
            }
        }
        
        $kpis["MFA_Adoption_Rate"] = [math]::Round(($mfaEnabledUsers / $users.Count) * 100, 2)
        
        # 2. æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚«ãƒãƒ¬ãƒƒã‚¸
        $policies = Get-MgIdentityConditionalAccessPolicy
        $enabledPolicies = $policies | Where-Object { $_.State -eq "enabled" }
        $kpis["Conditional_Access_Policies"] = $enabledPolicies.Count
        
        # 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæ•°ï¼ˆéå»30æ—¥ï¼‰
        $incidentLogs = Get-ChildItem -Path "C:\SecurityLogs\Incidents_*.json" -ErrorAction SilentlyContinue
        $recentIncidents = 0
        
        foreach ($logFile in $incidentLogs) {
            $incidents = Get-Content $logFile | ConvertFrom-Json
            $recentIncidents += ($incidents | Where-Object { 
                [datetime]$_.Timestamp -gt (Get-Date).AddDays(-30) 
            }).Count
        }
        
        $kpis["Security_Incidents_30d"] = $recentIncidents
        
        # 4. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆç‡ï¼ˆéå»30æ—¥ï¼‰
        $passwordResets = Search-UnifiedAuditLog -StartDate (Get-Date).AddDays(-30) -EndDate (Get-Date) -Operations "Reset user password"
        $kpis["Password_Resets_30d"] = $passwordResets.Count
        
        # 5. å¤–éƒ¨å…±æœ‰ç‡
        $externalSharing = Search-UnifiedAuditLog -StartDate (Get-Date).AddDays(-30) -EndDate (Get-Date) -Operations "SharingInvitationCreated"
        $kpis["External_Sharing_30d"] = $externalSharing.Count
        
        # 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œæ™‚é–“ï¼ˆå¹³å‡ï¼‰
        # å®Ÿè£…ã¯ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã«ä¾å­˜
        $kpis["Alert_Response_Time_Hours"] = 2.5  # ä¾‹ï¼šå¹³å‡2.5æ™‚é–“
        
        # 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Œäº†ç‡
        # å®Ÿè£…ã¯ç ”ä¿®ã‚·ã‚¹ãƒ†ãƒ ã«ä¾å­˜
        $kpis["Security_Training_Completion"] = 87.5  # ä¾‹ï¼š87.5%
        
        Write-Host "âœ“ KPIæ¸¬å®šå®Œäº†" -ForegroundColor Green
        
    }
    catch {
        Write-Host "âœ— KPIæ¸¬å®šã‚¨ãƒ©ãƒ¼: $($_.Exception.Message)" -ForegroundColor Red
    }
    
    # æ¸¬å®šçµæœã®ä¿å­˜
    $kpiReport = @{
        MeasurementDate = $measurementDate
        KPIs = $kpis
        Targets = @{
            MFA_Adoption_Rate = 95
            Conditional_Access_Policies = 5
            Security_Incidents_30d = 0
            Password_Resets_30d = 10
            External_Sharing_30d = 50
            Alert_Response_Time_Hours = 2
            Security_Training_Completion = 90
        }
    }
    
    $kpiReport | ConvertTo-Json -Depth 3 | Out-File -FilePath $reportPath -Encoding UTF8
    
    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    Write-Host "`n=== ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£KPIãƒ¬ãƒãƒ¼ãƒˆ ===" -ForegroundColor Cyan
    Write-Host "æ¸¬å®šæ—¥: $($measurementDate.ToString('yyyy-MM-dd HH:mm:ss'))" -ForegroundColor White
    Write-Host "MFAå°å…¥ç‡: $($kpis['MFA_Adoption_Rate'])% (ç›®æ¨™: 95%)" -ForegroundColor White
    Write-Host "æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼æ•°: $($kpis['Conditional_Access_Policies']) (ç›®æ¨™: 5)" -ForegroundColor White
    Write-Host "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæ•°: $($kpis['Security_Incidents_30d']) (ç›®æ¨™: 0)" -ForegroundColor White
    Write-Host "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ•°: $($kpis['Password_Resets_30d']) (ç›®æ¨™: 10ä»¥ä¸‹)" -ForegroundColor White
    Write-Host "å¤–éƒ¨å…±æœ‰æ•°: $($kpis['External_Sharing_30d']) (ç›®æ¨™: 50ä»¥ä¸‹)" -ForegroundColor White
    
    Write-Host "`nKPIãƒ¬ãƒãƒ¼ãƒˆä¿å­˜: $reportPath" -ForegroundColor Green
}

# å®Ÿè¡Œä¾‹
Measure-SecurityKPIs -OutputPath "C:\SecurityReports\KPI\"
```

### 6.5.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–‡åŒ–ã®é†¸æˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•™è‚²ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

**æ®µéšçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ•™è‚²ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼š**

```
ãƒ¬ãƒ™ãƒ«1: åŸºç¤æ•™è‚²ï¼ˆå…¨å¾“æ¥­å“¡å¯¾è±¡ï¼‰
â–¡ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®é‡è¦æ€§
â–¡ ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è©æ¬ºã®è­˜åˆ¥
â–¡ å¤šè¦ç´ èªè¨¼ã®ä½¿ç”¨æ–¹æ³•
â–¡ å®‰å…¨ãªæƒ…å ±å…±æœ‰

ãƒ¬ãƒ™ãƒ«2: ç®¡ç†è€…æ•™è‚²ï¼ˆç®¡ç†è·å¯¾è±¡ï¼‰
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ç†è§£
â–¡ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã®åŸºæœ¬
â–¡ ãƒªã‚¹ã‚¯è©•ä¾¡ã®æ–¹æ³•
â–¡ æ³•çš„è¦ä»¶ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

ãƒ¬ãƒ™ãƒ«3: æŠ€è¡“è€…æ•™è‚²ï¼ˆITéƒ¨é–€å¯¾è±¡ï¼‰
â–¡ é«˜åº¦ãªè„…å¨ã®å¯¾å‡¦æ³•
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨
â–¡ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆèª¿æŸ»ã®æŠ€æ³•
â–¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®æœ€é©åŒ–
```

### 6.5.3 å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

**ğŸ“‹ å®Ÿè·µï¼šå®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡**

```markdown
# å››åŠæœŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## 1. æŠ€è¡“çš„çµ±åˆ¶

### 1.1 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- [ ] MFAæœ‰åŠ¹åŒ–ç‡ 95% ä»¥ä¸Š
- [ ] æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®æœ‰åŠ¹æ€§ç¢ºèª
- [ ] ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æœ€å°é™ä½¿ç”¨
- [ ] å®šæœŸçš„ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼

### 1.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·
- [ ] æ©Ÿå¯†åº¦ãƒ©ãƒ™ãƒ«ã®é©åˆ‡ãªé©ç”¨
- [ ] DLPãƒãƒªã‚·ãƒ¼ã®æœ‰åŠ¹æ€§ç¢ºèª
- [ ] æš—å·åŒ–çŠ¶æ³ã®ç¢ºèª
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å®Œå…¨æ€§ç¢ºèª

### 1.3 ç›£è¦–ãƒ»æ¤œå‡º
- [ ] ç›£æŸ»ãƒ­ã‚°ã®åé›†ãƒ»åˆ†æ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆã®å¯¾å¿œçŠ¶æ³
- [ ] ç•°å¸¸æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®æœ‰åŠ¹æ€§
- [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ™‚é–“ã®æ¸¬å®š

## 2. ç®¡ç†çš„çµ±åˆ¶

### 2.1 ãƒãƒªã‚·ãƒ¼ãƒ»æ‰‹é †
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®æ›´æ–°
- [ ] æ‰‹é †æ›¸ã®æœ€æ–°åŒ–
- [ ] å½¹å‰²ã¨è²¬ä»»ã®æ˜ç¢ºåŒ–
- [ ] æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã®æœ‰åŠ¹æ€§

### 2.2 æ•™è‚²ãƒ»è¨“ç·´
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç ”ä¿®ã®å®Ÿæ–½çŠ¶æ³
- [ ] ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è¨“ç·´ã®çµæœ
- [ ] ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè¨“ç·´
- [ ] æ–°å…¥ç¤¾å“¡å‘ã‘ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

### 2.3 ãƒ™ãƒ³ãƒ€ãƒ¼ç®¡ç†
- [ ] ç¬¬ä¸‰è€…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡
- [ ] å¥‘ç´„ã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¡é …
- [ ] ãƒ‡ãƒ¼ã‚¿å‡¦ç†å§”è¨—å…ˆã®ç›£æŸ»
- [ ] ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šç¢ºèª

## 3. ç‰©ç†çš„çµ±åˆ¶

### 3.1 ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
- [ ] ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã®ç®¡ç†çŠ¶æ³
- [ ] ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã®å®‰å…¨æ€§
- [ ] ç´›å¤±ãƒ»ç›—é›£æ™‚ã®å¯¾å¿œæ‰‹é †
- [ ] ãƒ‡ãƒã‚¤ã‚¹ã®æš—å·åŒ–çŠ¶æ³

### 3.2 ç’°å¢ƒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ã‚ªãƒ•ã‚£ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- [ ] æ©Ÿå¯†æ–‡æ›¸ã®ç®¡ç†
- [ ] å»ƒæ£„å‡¦ç†ã®é©åˆ‡æ€§
- [ ] æ¸…æƒãƒ»ç«‹å…¥è¦å‰‡ã®éµå®ˆ

## 4. æ³•çš„ãƒ»è¦åˆ¶è¦ä»¶

### 4.1 ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- [ ] å€‹äººæƒ…å ±ä¿è­·æ³•ã®éµå®ˆ
- [ ] æ¥­ç•Œå›ºæœ‰ã®è¦åˆ¶è¦ä»¶
- [ ] å›½éš›çš„ãªè¦åˆ¶ã¸ã®å¯¾å¿œ
- [ ] å†…éƒ¨ç›£æŸ»ã®å®Ÿæ–½

### 4.2 å¥‘ç´„ãƒ»æ³•å‹™
- [ ] åˆ©ç”¨è¦ç´„ã®æ›´æ–°
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»ãƒãƒªã‚·ãƒ¼ã®è¦‹ç›´ã—
- [ ] ãƒ‡ãƒ¼ã‚¿å‡¦ç†åŒæ„ã®å–å¾—
- [ ] æ³•çš„é€šçŸ¥ã®å¯¾å¿œ

## 5. æ”¹å–„è¨ˆç”»

### 5.1 å‰å›è©•ä¾¡ã‹ã‚‰ã®æ”¹å–„
- [ ] å‰å›æŒ‡æ‘˜äº‹é …ã®å¯¾å¿œç¢ºèª
- [ ] æ”¹å–„è¨ˆç”»ã®é€²æ—ç¢ºèª
- [ ] åŠ¹æœæ¸¬å®šã®å®Ÿæ–½
- [ ] è¿½åŠ å¯¾ç­–ã®æ¤œè¨

### 5.2 ä»Šå›ã®æ”¹å–„äº‹é …
- [ ] æ–°ãŸã«ç™ºè¦‹ã•ã‚ŒãŸèª²é¡Œ
- [ ] å„ªå…ˆåº¦ã®è¨­å®š
- [ ] è²¬ä»»è€…ã®å‰²ã‚Šå½“ã¦
- [ ] å®Ÿæ–½ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç­–å®š

## è©•ä¾¡çµæœã¾ã¨ã‚

### ç·åˆè©•ä¾¡
- å„ªç§€ï¼ˆ90-100ç‚¹ï¼‰: [ ]
- è‰¯å¥½ï¼ˆ80-89ç‚¹ï¼‰: [ ]
- æ™®é€šï¼ˆ70-79ç‚¹ï¼‰: [ ]
- è¦æ”¹å–„ï¼ˆ60-69ç‚¹ï¼‰: [ ]
- ä¸é©åˆ‡ï¼ˆ60ç‚¹æœªæº€ï¼‰: [ ]

### ä¸»è¦ãªæ”¹å–„ç‚¹
1. ________________________________
2. ________________________________
3. ________________________________

### æ¬¡å›è©•ä¾¡äºˆå®šæ—¥
å®Ÿæ–½äºˆå®šæ—¥: ____å¹´____æœˆ____æ—¥
æ‹…å½“è€…: ________________________________
```

## ã¾ã¨ã‚

ã“ã®ç« ã§ã¯ã€ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸã€‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®å®Ÿè£…**
   - Microsoft Defender for Office 365ã®æ´»ç”¨
   - Azure Security Center ã«ã‚ˆã‚‹ç›£è¦–
   - Identity Protection ã«ã‚ˆã‚‹ãƒªã‚¹ã‚¯ç®¡ç†

2. **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç®¡ç†**
   - ãƒ‡ãƒ¼ã‚¿ä¿è­·ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å¯¾å¿œ
   - æƒ…å ±ã‚¬ãƒãƒŠãƒ³ã‚¹ã®å®Ÿè£…
   - æ³•çš„è¦ä»¶ã¸ã®å¯¾å¿œ

3. **ç›£æŸ»ã¨ãƒ­ã‚°ç®¡ç†**
   - çµ±åˆç›£æŸ»ãƒ­ã‚°ã®æ´»ç”¨
   - ç›£æŸ»ãƒ­ã‚°ã®åˆ†æã¨å¯¾å¿œ
   - Microsoft Sentinel ã¨ã®é€£æº

4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨ã®è‡ªå‹•åŒ–**
   - å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
   - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã®è‡ªå‹•åŒ–
   - PowerShell ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–

5. **ç¶™ç¶šçš„ãªæ”¹å–„**
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŒ‡æ¨™ã®ç›£è¦–
   - å®šæœŸçš„ãªè©•ä¾¡ã®å®Ÿæ–½
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–‡åŒ–ã®é†¸æˆ

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¯ä¸€åº¦è¨­å®šã™ã‚Œã°çµ‚ã‚ã‚Šã§ã¯ãªãã€ç¶™ç¶šçš„ãªç›£è¦–ã¨æ”¹å–„ãŒå¿…è¦ã§ã™ã€‚æŠ€è¡“ã®é€²æ­©ã‚„è„…å¨ã®å¤‰åŒ–ã«å¯¾å¿œã—ã€çµ„ç¹”å…¨ä½“ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ„è­˜ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

æ¬¡ç« ã§ã¯ã€æ—¥å¸¸çš„ãªé‹ç”¨æ¥­å‹™ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ã€å®Ÿè·µçš„ãªé‹ç”¨ãƒã‚¦ãƒã‚¦ã‚’è©³ã—ãå­¦ã‚“ã§ã„ãã¾ã™ã€‚