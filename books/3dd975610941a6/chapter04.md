---
title: "第4章: Azureの基本操作と管理"
---

# はじめに

前章では、Microsoft 365の各サービスの基本設定と管理方法を学びました。この章では、Microsoft Azureの基本操作について、仮想マシンやストレージなどの主要サービスの設定・管理方法を実践的に学んでいきます。

Azureは、豊富なサービスを提供するクラウドプラットフォームです。新人エンジニアから経験豊富な管理者まで、それぞれのレベルに応じて段階的に理解できるよう説明していきます。

## 4.1 Azureの基本概念

### 4.1.1 Azureの全体像

#### クラウドプラットフォームとしてのAzure

**Microsoft Azure**は、世界中のデータセンターで提供される包括的なクラウドプラットフォームです。

**Azureの特徴：**
- **グローバル展開**: 世界60以上のリージョンで提供
- **豊富なサービス**: 200以上のサービスを提供
- **エンタープライズ対応**: 企業レベルのセキュリティと信頼性
- **ハイブリッド対応**: オンプレミスとの統合
- **DevOps対応**: 開発から運用までの一貫したサポート

#### 他のクラウドプラットフォームとの比較

**Amazon Web Services (AWS)**
- **強み**: 最も成熟したクラウドプラットフォーム
- **特徴**: 豊富なサービス、大きなコミュニティ
- **適用**: スタートアップから大企業まで幅広い

**Google Cloud Platform (GCP)**
- **強み**: AI/機械学習、データ分析
- **特徴**: Googleの技術力、革新的なサービス
- **適用**: データドリブンな企業、開発者向け

**Microsoft Azure**
- **強み**: Microsoft製品との統合、ハイブリッド対応
- **特徴**: 企業向けの機能、既存システムとの親和性
- **適用**: Microsoft環境の企業、エンタープライズ

### 4.1.2 サブスクリプションとリソース管理

#### サブスクリプションの概念

**サブスクリプション**は、Azureサービスの課金とアクセス制御の境界です。

**サブスクリプションの役割：**
- **課金境界**: 費用の分離と管理
- **アクセス制御**: 権限管理の境界
- **リソース制限**: 作成可能なリソースの制限
- **ポリシー適用**: 組織ポリシーの適用範囲

**サブスクリプションの種類：**
- **従量課金**: 使用した分だけ支払い
- **Enterprise Agreement**: 企業契約による割引
- **CSP (Cloud Solution Provider)**: パートナー経由での契約
- **無料アカウント**: 12か月間の無料利用

#### リソースグループの設計

**リソースグループ**は、関連するAzureリソースをまとめて管理する論理的なコンテナです。

**リソースグループの特徴：**
- **ライフサイクル管理**: 一括での作成・削除
- **権限管理**: グループ単位での権限設定
- **課金管理**: グループ単位での費用集計
- **リソース間の依存関係**: 関連リソースの管理

**📋 実践：リソースグループの設計原則**

```
リソースグループ設計の考え方：
1. 用途別の分離
   - rg-web-production（本番WebサーバーQ）
   - rg-web-development（開発WebサーバーQ）
   - rg-database-production（本番データベース）

2. 環境別の分離
   - rg-production（本番環境）
   - rg-staging（ステージング環境）
   - rg-development（開発環境）

3. 部門別の分離
   - rg-sales（営業部）
   - rg-hr（人事部）
   - rg-finance（経理部）
```

### 4.1.3 リージョンとAvailability Zone

#### リージョンの選択基準

**リージョン**は、Azureサービスが提供される地理的な場所です。

**リージョン選択の考慮点：**
1. **レイテンシ**: ユーザーとの物理的な距離
2. **データ主権**: データの保存場所に関する法的要件
3. **サービス可用性**: 必要なサービスの提供状況
4. **災害対策**: 地理的な分散によるリスク軽減
5. **コスト**: リージョンによる価格差

**日本で利用可能なリージョン：**
- **東日本 (Japan East)**: 東京データセンター
- **西日本 (Japan West)**: 大阪データセンター

#### 高可用性の設計

**Availability Zone (AZ)**は、リージョン内の独立したデータセンターです。

**高可用性設計の原則：**
1. **複数AZの利用**: 単一障害点の回避
2. **負荷分散**: 複数のインスタンスへの分散
3. **自動復旧**: 障害時の自動的な復旧
4. **データレプリケーション**: データの複製と同期

**📊 高可用性アーキテクチャの例**

```
            ┌─────────────────────────────────┐
            │          Load Balancer          │
            └─────────────┬───────────────────┘
                          │
            ┌─────────────┴───────────────────┐
            │                                 │
    ┌───────▼───────┐                ┌───────▼───────┐
    │ Availability   │                │ Availability   │
    │ Zone 1         │                │ Zone 2         │
    │ ┌─────────────┐│                │ ┌─────────────┐│
    │ │Web Server 1 ││                │ │Web Server 2 ││
    │ └─────────────┘│                │ └─────────────┘│
    └─────────────────┘                └─────────────────┘
```

## 4.2 仮想マシンの管理

### 4.2.1 仮想マシンの基本概念

#### 仮想マシンとは

**Azure Virtual Machines (VM)**は、Azure上で動作する仮想化されたコンピューターです。

**仮想マシンの特徴：**
- **柔軟性**: 様々なOSとアプリケーションをサポート
- **スケーラビリティ**: 性能の動的な調整
- **可用性**: 高可用性オプション
- **セキュリティ**: 企業レベルのセキュリティ機能

#### VMサイズの選択

**VMサイズ**は、仮想マシンのCPU、メモリ、ストレージの組み合わせです。

**主要なVMシリーズ：**
- **B シリーズ**: バーストパフォーマンス（開発・テスト用）
- **D シリーズ**: 汎用（本番ワークロード）
- **E シリーズ**: メモリ最適化（データベース）
- **F シリーズ**: コンピューティング最適化（高性能計算）

**📋 実践：VMサイズの選択指針**

```
用途別VMサイズの推奨：
1. 開発・テスト環境
   - B1s: 1コア、1GB RAM（月額約1,500円）
   - B2s: 2コア、4GB RAM（月額約3,000円）

2. 本番環境（Web サーバー）
   - Standard_D2s_v3: 2コア、8GB RAM（月額約8,000円）
   - Standard_D4s_v3: 4コア、16GB RAM（月額約16,000円）

3. データベースサーバー
   - Standard_E2s_v3: 2コア、16GB RAM（月額約12,000円）
   - Standard_E4s_v3: 4コア、32GB RAM（月額約24,000円）
```

### 4.2.2 仮想マシンの作成

#### VMの作成手順

**📋 実践：Azure portalでのVM作成**

**基本設定：**
1. **Azure portal** > **仮想マシン** > **作成**
2. **サブスクリプション**: 適切なサブスクリプションを選択
3. **リソースグループ**: 新規作成または既存を選択
4. **仮想マシン名**: `vm-web-prod-001`
5. **リージョン**: `Japan East`
6. **イメージ**: `Windows Server 2022 Datacenter`
7. **サイズ**: `Standard_D2s_v3`

**管理者アカウント設定：**
- **認証の種類**: パスワード
- **ユーザー名**: `azureuser`
- **パスワード**: 複雑なパスワードを設定

**受信ポート規則：**
- **選択された受信ポート**: `RDP (3389)`
- **HTTP (80)**: 必要に応じて
- **HTTPS (443)**: 必要に応じて

#### ネットワーク設定

**仮想ネットワーク（VNet）**
- **アドレス空間**: `10.0.0.0/16`
- **サブネット**: `10.0.1.0/24`
- **パブリックIP**: 必要に応じて作成

**ネットワークセキュリティグループ（NSG）**
- **受信規則**: 必要なポートのみ許可
- **送信規則**: 必要に応じて制限

### 4.2.3 仮想マシンの運用管理

#### 起動・停止の管理

**VM の状態：**
- **実行中**: 課金対象
- **停止済み**: 課金対象（割り当て解除ではない）
- **停止済み（割り当て解除）**: 課金対象外

**📋 実践：コスト効率的な運用**

```
VMの状態管理：
1. 開発環境
   - 業務時間外: 停止（割り当て解除）
   - 週末: 停止（割り当て解除）
   - 月間コスト削減: 約60-70%

2. 本番環境
   - 24時間稼働: 実行中
   - メンテナンス時: 停止（割り当て解除）
   - 災害対策: 複数リージョンでの冗長化
```

#### 監視とアラート

**Azure Monitor**を使用して、VMの状態を監視します。

**主要な監視項目：**
- **CPU使用率**: 性能の監視
- **メモリ使用量**: リソースの監視
- **ディスク使用量**: 容量の監視
- **ネットワーク**: 通信量の監視

**📋 実践：基本的なアラート設定**

**設定手順：**
1. **VM** > **監視** > **アラート**
2. **新しいアラート規則** をクリック
3. **条件**: `CPU使用率 > 80%`
4. **期間**: `5分間継続`
5. **アクション**: メール通知
6. **受信者**: 管理者のメールアドレス

#### バックアップと復旧

**Azure Backup**を使用して、VMの定期バックアップを実施します。

**バックアップの種類：**
- **アプリケーション整合性**: アプリケーションの状態を保持
- **ファイルシステム整合性**: ファイルシステムの整合性を保持
- **クラッシュ整合性**: 最低限の整合性

**📋 実践：バックアップ設定**

**設定手順：**
1. **VM** > **バックアップ** をクリック
2. **Recovery Services コンテナー**: 新規作成
3. **バックアップポリシー**: 既定のポリシーを使用
4. **バックアップの有効化** をクリック

**復旧手順：**
1. **Recovery Services コンテナー** > **バックアップ項目**
2. **復旧ポイント** を選択
3. **仮想マシンの復元** を選択
4. **復元の種類**: 新規作成または置換

## 4.3 ストレージとネットワーク

### 4.3.1 Azureストレージの基本

#### ストレージアカウントの概念

**ストレージアカウント**は、Azureストレージサービスの名前空間です。

**ストレージサービスの種類：**
- **Blob Storage**: オブジェクトストレージ
- **File Storage**: ファイル共有
- **Queue Storage**: メッセージキュー
- **Table Storage**: NoSQLデータベース

#### ストレージの種類と選択

**パフォーマンス層：**
- **Standard**: HDD ベース（コスト重視）
- **Premium**: SSD ベース（性能重視）

**冗長性オプション：**
- **LRS (Locally Redundant Storage)**: 同一データセンター内で3つの複製
- **ZRS (Zone Redundant Storage)**: 異なるAZ間で3つの複製
- **GRS (Geo Redundant Storage)**: 異なるリージョンへの複製
- **RA-GRS**: 読み取り専用の地理的冗長性

**📋 実践：ストレージアカウントの作成**

**設定手順：**
1. **Azure portal** > **ストレージアカウント** > **作成**
2. **基本設定**:
   - **名前**: `storageaccountname001`
   - **リージョン**: `Japan East`
   - **パフォーマンス**: `Standard`
   - **冗長性**: `LRS`
3. **詳細設定**:
   - **安全な転送**: 有効
   - **Blob パブリックアクセス**: 無効
   - **最小 TLS バージョン**: 1.2

### 4.3.2 ストレージの管理

#### Blobストレージの活用

**Blobストレージ**は、大量の非構造化データを格納するオブジェクトストレージです。

**Blobの種類：**
- **ブロックBlob**: 一般的なファイル（テキスト、画像、動画）
- **ページBlob**: 仮想マシンのディスク
- **追加Blob**: ログファイル

**アクセス層：**
- **Hot**: 頻繁にアクセスされるデータ
- **Cool**: 月1回程度アクセスされるデータ
- **Archive**: 年1回程度アクセスされるデータ

#### ファイル共有の設定

**Azure Files**は、SMBプロトコルでアクセスできるファイル共有サービスです。

**主な用途：**
- **オンプレミスとの統合**: ハイブリッドファイル共有
- **アプリケーション間の共有**: 複数のVMでの共有
- **バックアップ**: オンプレミスファイルのバックアップ

**📋 実践：ファイル共有の作成**

**設定手順：**
1. **ストレージアカウント** > **ファイル共有**
2. **新しいファイル共有** をクリック
3. **名前**: `shared-files`
4. **クォータ**: `100 GB`
5. **パフォーマンス**: `Standard`

**VMでのマウント：**
```powershell
# Windows での接続
net use Z: \\storageaccountname001.file.core.windows.net\shared-files /persistent:Yes
```

### 4.3.3 仮想ネットワークの設定

#### 仮想ネットワークの基本

**Azure Virtual Network (VNet)**は、Azure上でのプライベートネットワークです。

**VNetの特徴：**
- **分離**: 他のVNetから分離された環境
- **セキュリティ**: ネットワークレベルでのセキュリティ制御
- **オンプレミス接続**: VPN や ExpressRoute での接続
- **DNS**: カスタムDNSサーバーの設定

#### サブネットの設計

**サブネット**は、VNet内のネットワークセグメントです。

**サブネット設計の考え方：**
```
VNet: 10.0.0.0/16
├── Frontend Subnet: 10.0.1.0/24
│   └── Web サーバー用
├── Backend Subnet: 10.0.2.0/24
│   └── アプリケーションサーバー用
├── Database Subnet: 10.0.3.0/24
│   └── データベースサーバー用
└── Gateway Subnet: 10.0.255.0/27
    └── VPN Gateway 用
```

**📋 実践：VNetとサブネットの作成**

**設定手順：**
1. **Azure portal** > **仮想ネットワーク** > **作成**
2. **基本設定**:
   - **名前**: `vnet-prod-japaneast`
   - **リージョン**: `Japan East`
   - **アドレス空間**: `10.0.0.0/16`
3. **サブネット**:
   - **名前**: `subnet-web`
   - **アドレス範囲**: `10.0.1.0/24`

#### ネットワークセキュリティグループ

**Network Security Group (NSG)**は、ネットワークレベルのファイアウォールです。

**NSGの機能：**
- **受信規則**: 外部からのアクセス制御
- **送信規則**: 内部からのアクセス制御
- **優先度**: 規則の適用順序
- **ログ**: アクセスログの記録

**📋 実践：NSGの設定**

**Web サーバー用NSG：**
```
受信規則：
- HTTP (80): インターネットから許可
- HTTPS (443): インターネットから許可
- RDP (3389): 管理者IPのみ許可
- SSH (22): 管理者IPのみ許可

送信規則：
- すべて: 許可（既定）
```

## 4.4 データベースサービス

### 4.4.1 Azure SQL Databaseの基本

#### マネージドデータベースの利点

**Azure SQL Database**は、フルマネージドのSQL Serverデータベースサービスです。

**主な利点：**
- **管理の簡素化**: バックアップ、パッチ適用の自動化
- **高可用性**: 99.99%の可用性保証
- **スケーラビリティ**: 動的な性能調整
- **セキュリティ**: 高度なセキュリティ機能

#### サービス階層の選択

**サービス階層：**
- **Basic**: 軽量なワークロード
- **Standard**: 一般的なワークロード
- **Premium**: 高性能なワークロード

**vCore モデル：**
- **General Purpose**: 汎用的なワークロード
- **Business Critical**: ミッションクリティカルなワークロード
- **Hyperscale**: 超大容量データベース

### 4.4.2 データベースの作成と管理

#### データベースの作成

**📋 実践：Azure SQL Databaseの作成**

**設定手順：**
1. **Azure portal** > **SQL データベース** > **作成**
2. **基本設定**:
   - **データベース名**: `sqldb-prod-001`
   - **サーバー**: 新規作成
   - **サーバー名**: `sqlserver-prod-001`
   - **認証**: SQL認証
3. **コンピューティング + ストレージ**:
   - **サービス階層**: `Standard`
   - **DTU**: `S1 (20 DTU)`

#### 接続とセキュリティ

**接続文字列の取得：**
```
Server=sqlserver-prod-001.database.windows.net;
Database=sqldb-prod-001;
User ID=sqladmin;
Password=YourPassword;
```

**ファイアウォール設定：**
- **Azureサービス**: 許可
- **クライアントIP**: 管理者のIPアドレス
- **仮想ネットワーク**: 必要に応じて設定

## 4.5 コスト管理と最適化

### 4.5.1 コスト監視

#### Azure Cost Management

**Cost Management**を使用して、Azureの費用を監視・管理します。

**主要機能：**
- **コスト分析**: 詳細なコスト分析
- **予算設定**: 予算の設定とアラート
- **推奨事項**: コスト最適化の提案
- **レポート**: 定期的なコストレポート

#### 予算とアラート

**📋 実践：予算設定**

**設定手順：**
1. **Cost Management** > **予算**
2. **新しい予算** をクリック
3. **名前**: `月次予算`
4. **リセット期間**: `月次`
5. **予算金額**: `50,000円`
6. **アラート**: 80%、90%、100%で通知

### 4.5.2 リソース最適化

#### 使用していないリソースの特定

**最適化の対象：**
- **停止中のVM**: 削除または適切な停止
- **未使用のディスク**: 削除またはアーカイブ
- **古いスナップショット**: 削除
- **未使用のパブリックIP**: 削除

#### 適切なサイズ設定

**リソースサイズの見直し：**
- **VM**: 実際の使用量に基づくサイズ変更
- **データベース**: DTU/vCore の適正化
- **ストレージ**: アクセス頻度に基づく階層選択

## まとめ

この章では、Microsoft Azureの基本操作と管理方法を学びました。

### 重要なポイント

1. **Azureの基本概念**
   - サブスクリプションとリソース管理
   - リージョンとAvailability Zoneの理解
   - 高可用性設計の原則

2. **仮想マシンの管理**
   - VMサイズの適切な選択
   - 運用管理とコスト最適化
   - バックアップと復旧

3. **ストレージとネットワーク**
   - ストレージサービスの選択
   - 仮想ネットワークの設計
   - セキュリティグループの設定

4. **データベースサービス**
   - マネージドデータベースの活用
   - 適切なサービス階層の選択
   - セキュリティ設定

5. **コスト管理**
   - 継続的な監視と最適化
   - 予算設定とアラート
   - リソースの適正化

次章では、PowerShellを使用したクラウドリソースの効率的な管理について、自動化と運用の観点から詳しく学んでいきます。